<html>
    <meta charset="UTF-8">
    <head>
        <title>Birbs</title>
        
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="http://malsup.github.com/jquery.form.js"></script> 
        <script type="text/javascript">
            $(document).ready(function(){
                var checkbox = document.querySelector('input[type="checkbox"]');
                var slider = document.getElementById("ledRange");

                checkbox.addEventListener('change', function (event) {
                    console.log(checkbox.checked);
                    if (checkbox.checked) {
                        set_state(1);
                    } else {
                        set_state(0);
                    }

                    console.log(checkbox.checked);
                });
                slider.addEventListener('input', function (event) {
                    console.log(slider.value);
                    set_state(-1, slider.value);
                    console.log(slider.value);
                })


                function set_state(state=-1, value = -1) {
                    console.log("set state");

                    data = {};
                    if (state >= 0) {
                        data["state"] = state
                    }
                    if (value >= 0) {
                        data["value"] = value
                    }
                    console.log(data);
                    fetch("/api/leds", {
                        method: 'POST',
                        headers: {
                            'Accept': 'application/json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    })
                        .then(function(response) {
                            return response.json()
                        })
                        .then(function(data){
                            console.log('got responce', data);

                        })
                        .catch(function() {
                            console.log('get status error');
                        });
                }

                var timeout = setTimeout(updateStatus, 10);

                function updateStatus() {

                    fetch("/api/leds", {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json',
                            'Content-Type': 'application/json'
                        }
                    })
                        .then(function(response) {
                            return response.json()
                        })
                        .then(function(data){
                            console.log('got responce', data);
                            checkbox.checked = data['state'];
                            slider.value = data['value'];
                        })
                        .catch(function() {
                            console.log('get status error');
                        });

                    timeout = setTimeout(updateStatus, 5000);
                }
            });
      </script>

    </head>
    <body>
    <dev>
    <form>
        <label>leds</label>
        <label class="switch">
            <input type="checkbox">
            <span class="slider round"></span>
        </label>


        <label class="slidecontainer">
            <input type="range" min="0" max="255" step="5" value="0" class="led_slider" id="ledRange">
        </label>
    </form>
    <a href="cameras">cameras</a>

    </dev>
    </body>
</html>
